apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

# Namespace para desenvolvimento local (Minikube)
namespace: oficina

resources:
  # Base resources
  - ../../base

  # Local-specific resources
  - namespace.yaml
  - secret-database.yaml
  - secret-auth.yaml
  - secret-notification.yaml
  - ingress.yaml

# Patches para ambiente local
patches:
  # Ajustar imagePullPolicy para desenvolvimento local
  - target:
      kind: Deployment
    patch: |-
      - op: replace
        path: /spec/template/spec/containers/0/imagePullPolicy
        value: IfNotPresent
  # Remover NLB Service (n√£o suportado no Minikube)
  - target:
      kind: Service
      name: eureka-server-nlb
    patch: |-
      apiVersion: v1
      kind: Service
      metadata:
        name: eureka-server-nlb
      $patch: delete

# ConfigMap para usar service interno no Minikube
configMapGenerator:
  - name: eureka-server-config
    behavior: merge
    literals:
      - EUREKA_HOSTNAME=eureka-server-internal.oficina.svc.cluster.local
      - EUREKA_CLIENT_SERVICEURL_DEFAULTZONE=http://eureka-server-internal.oficina.svc.cluster.local:8761/eureka/

# Labels comuns para ambiente local
commonLabels:
  environment: local
  managed-by: kustomize

# Annotations comuns
commonAnnotations:
  deployment-method: minikube
